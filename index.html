<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å°–å±±é›»å» ç³»çµ± (å“¡å·¥ç«¯)</title>
  <style>
    /* ... (ä¿ç•™åŸæœ‰ CSSï¼Œå¢åŠ  Table æ¨£å¼) ... */
    body { font-family: "Microsoft JhengHei", sans-serif; padding: 15px; background: #f4f7f6; margin: 0; color: #333; }
    .container { max-width: 480px; margin: 0 auto; background: white; padding: 20px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); min-height: 80vh; position: relative; }
    h2 { text-align: center; color: #2c3e50; margin-bottom: 20px; font-weight: 800; }
    .hidden { display: none !important; }
    #loading-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 99; display: flex; justify-content: center; align-items: center; border-radius: 16px; font-weight: bold; color: #666; }
    input, select { width: 100%; padding: 12px; margin-bottom: 12px; border: 1px solid #e0e0e0; border-radius: 8px; box-sizing: border-box; font-size: 15px; background: #fff; }
    label { font-weight: 600; display: block; margin-bottom: 6px; color: #555; font-size: 14px; }
    button { padding: 14px; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; color: white; transition: 0.2s; width: 100%; margin-top: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    button:active { transform: scale(0.98); }
    
    /* æŒ‰éˆ•è‰²ç³» */
    .btn-in { background: linear-gradient(135deg, #3b82f6, #2563eb); } 
    .btn-out { background: linear-gradient(135deg, #ef4444, #dc2626); }
    .btn-leave { background: linear-gradient(135deg, #f59e0b, #d97706); }
    .btn-search { background: #64748b; margin-top: 0; font-size: 14px; padding: 10px; } 
    .btn-fix { background: #4b5563; }
    .btn-edit { background: #94a3b8; font-size: 12px; padding: 6px 12px; width: auto; margin-left: auto; border-radius: 20px; }

    /* Tabs */
    .tabs { display: flex; margin-bottom: 20px; background: white; border-radius: 12px; padding: 5px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border: 1px solid #eee; }
    .tab { flex: 1; padding: 10px; text-align: center; cursor: pointer; color: #64748b; font-weight: bold; font-size: 14px; border-radius: 8px; transition: 0.3s; }
    .tab.active { background: #3b82f6; color: white; box-shadow: 0 2px 5px rgba(59,130,246,0.3); }

    /* é¤˜é¡å¤§æ•¸æ“šçœ‹æ¿ (æ–°æ¨£å¼) */
    .stats-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; text-align: center; }
    .stat-card { background: #f8fafc; padding: 10px; border-radius: 10px; border: 1px solid #e2e8f0; }
    .stat-num { display: block; font-size: 24px; font-weight: 800; color: #1a73e8; }
    .stat-label { font-size: 12px; color: #64748b; }

    /* è¡¨æ ¼æ¨£å¼ (åˆ·å¡ç´€éŒ„ç”¨) */
    .history-table { width: 100%; border-collapse: collapse; font-size: 14px; margin-top: 10px; }
    .history-table th, .history-table td { border-bottom: 1px solid #eee; padding: 10px; text-align: left; }
    .history-table th { color: #666; font-size: 12px; }
    .history-table td { color: #333; }
    .tag { display: inline-block; padding: 3px 8px; border-radius: 4px; font-size: 12px; }
    .tag-green { background: #dcfce7; color: #166534; }
    .tag-red { background: #fee2e2; color: #991b1b; }
    
    /* å…¶ä»–æ¨£å¼ç¶­æŒä¸è®Š */
    .sub-tabs { display: flex; gap: 5px; margin-bottom: 15px; overflow-x: auto; }
    .sub-tab { flex: 1; padding: 8px; text-align: center; cursor: pointer; color: #666; background: #f1f5f9; font-size: 13px; border-radius: 6px; white-space: nowrap; }
    .sub-tab.active { background: #64748b; color: white; font-weight: bold; }
    .gps-box { text-align: center; padding: 20px; border-radius: 12px; background: #f8fafc; margin-bottom: 20px; border: 1px solid #e2e8f0; }
    .gps-status-ok { background: #f0fdf4; border-color: #bbf7d0; color: #166534; }
    .gps-status-err { background: #fef2f2; border-color: #fecaca; color: #991b1b; }
    .search-box { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; padding: 15px; margin-bottom: 15px; }
    .date-row { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; }
    .date-row input { margin-bottom: 0; flex: 1; }
  </style>
  
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>

<div class="container">
  <div id="loading-screen">ç³»çµ±è¼‰å…¥ä¸­...</div>

  <h2>âš¡ å°–å±±é›»å» ç³»çµ±</h2>
  
  <div id="login-section" class="hidden" style="text-align:center; padding: 40px 0;">
    <button class="btn-in" onclick="loginGoogle()">ğŸ”µ Google ç™»å…¥</button>
  </div>

  <div id="main-section" class="hidden">
    <div style="display:flex; align-items:center; background:#f1f5f9; padding:15px; border-radius:12px; margin-bottom:20px;">
      <img id="u-photo" src="" alt="" style="width:50px;height:50px;border-radius:50%;margin-right:15px;">
      <div style="flex-grow:1;">
        <div id="u-name" style="font-weight:800;font-size:18px;">...</div>
        <div id="u-company-display" style="font-size:13px;color:#64748b;">è®€å–ä¸­...</div>
      </div>
      <button class="btn-edit" onclick="toggleEditMode()">ä¿®æ”¹è³‡æ–™</button>
    </div>

    <div id="meta-form" class="hidden" style="background: #f8fafc; padding: 20px; margin-bottom: 20px; border-radius:12px; border:1px solid #e2e8f0;">
        <h4 style="margin-top:0;">ğŸ‘¤ å€‹äººæª”æ¡ˆ</h4>
        <label>çœŸå¯¦å§“å</label><input type="text" id="dbName">
        <label>æ‰‹æ©Ÿè™Ÿç¢¼</label><input type="text" id="dbPhone" placeholder="09xx-xxx-xxx">
        <label>è·ç¨±</label><input type="text" id="jobTitle">
        
        <label>æ‰€å±¬ç¾¤çµ„ (å½±éŸ¿ä¸‹ç­æ™‚é–“)</label>
        <select id="workShift" disabled style="background:#eee;">
            <option value="normal">æ­£å¸¸ç­ (08:00~16:30)</option>
            <option value="cleaning">æ¸…æ½”ç­ (08:00~17:00)</option>
        </select>
        
        <label>åº•è–ª (åƒ…ç®¡ç†è€…å¯ä¿®æ”¹)</label>
        <input type="number" id="baseSalary" disabled style="background:#eee;" placeholder="æœªè¨­å®š">

        <label>åˆ°è·æ—¥</label><input type="date" id="onboardDate" disabled style="background:#eee;">
        
        <button class="btn-in" onclick="saveToFirebase()">å„²å­˜è®Šæ›´</button>
    </div>

    <div class="tabs">
      <div id="tab-btn-clock" class="tab active" onclick="switchTab('clock')">æ‰“å¡</div>
      <div id="tab-btn-leave" class="tab" onclick="switchTab('leave')">è«‹å‡</div>
      <div id="tab-btn-task" class="tab" onclick="switchTab('task')">å¾…è¾¦</div>
      <div id="tab-btn-history" class="tab" onclick="switchTab('history')">ç´€éŒ„</div>
    </div>

    <div id="tab-clock">
        <div id="gps-box" class="gps-box">
            <div id="gps-icon" style="font-size:40px;">ğŸ“¡</div>
            <div id="gps-title" style="font-weight:bold;">å®šä½ä¸­...</div>
            <div id="gps-desc">è«‹ç¨å€™</div>
        </div>
        <div class="btn-grid" style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
            <button class="btn-in" onclick="doClock('ä¸Šç­')">ä¸Šç­æ‰“å¡<br><small>08:00</small></button>
            <button class="btn-leave" onclick="doClock('å¤–å‡º')">å¤–å‡º/å…¬å‹™</button>
            <button class="btn-out" onclick="doClock('ä¸‹ç­')">ä¸‹ç­æ‰“å¡<br><small>è‡ªå‹•åˆ¤æ–·</small></button>
            <button class="btn-leave" onclick="doClock('è¿”å›')">è¿”å›/éŠ·å‡</button>
        </div>
        <button class="btn-fix" onclick="toggleFix()" style="margin-top:20px;">ğŸ› ï¸ ç”³è«‹è£œåˆ·å¡ (å¿˜è¨˜æ‰“å¡)</button>
        <div id="fix-form" class="hidden" style="margin-top:10px; background:#f1f5f9; padding:15px; border-radius:10px;">
            <label>é¡å‹</label><select id="fixType" onchange="updateFixTimeDefaults()"><option value="ä¸Šç­">ä¸Šç­</option><option value="ä¸‹ç­">ä¸‹ç­</option></select>
            <label>æ—¥æœŸ</label><input type="date" id="fixDate">
            <label>æ™‚é–“</label><input type="time" id="fixTime">
            <label>äº‹ç”±</label><input type="text" id="fixReason">
            <button class="btn-fix" onclick="submitApp('correction')">é€å‡ºç”³è«‹</button>
        </div>
    </div>

    <div id="tab-leave" class="hidden">
        <label>å‡åˆ¥</label>
        <select id="leaveType" onchange="updateBalanceDisplay()">
            <option value="ç‰¹ä¼‘">ç‰¹ä¼‘</option><option value="è£œä¼‘">è£œä¼‘</option><option value="äº‹å‡">äº‹å‡</option><option value="ç—…å‡">ç—…å‡</option>
        </select>

        <div id="balance-panel" class="hidden">
            <div class="stats-grid">
                <div class="stat-card"><span class="stat-num" id="bal-total">-</span><span class="stat-label">ä»Šå¹´æ‡‰ä¼‘</span></div>
                <div class="stat-card"><span class="stat-num" id="bal-used">-</span><span class="stat-label">å·²ä¼‘å¤©æ•¸</span></div>
                <div class="stat-card" style="border-color:#f59e0b; background:#fffbeb;"><span class="stat-num" id="bal-left" style="color:#d97706">-</span><span class="stat-label">å‰©é¤˜å¤©æ•¸</span></div>
            </div>
        </div>

        <label>ä»£ç†äºº</label><select id="agentSelect"></select>
        <div style="display:flex;gap:10px;align-items:center; margin-top:10px;">
            <div style="flex:1"><label>é–‹å§‹</label><input type="datetime-local" id="l-start"></div>
            <div style="flex:1"><label>çµæŸ</label><input type="datetime-local" id="l-end"></div>
        </div>
        <div id="calc-result" style="text-align:right; font-weight:bold; color:#2563eb; margin-bottom:10px;">åˆè¨ˆï¼š0 å°æ™‚</div>
        <button class="btn-leave" onclick="submitApp('leave')">é€å‡ºå‡å–®</button>
    </div>

    <div id="tab-task" class="hidden">
        <button class="btn-edit" onclick="loadTasks()" style="width:100%; margin-bottom:15px;">ğŸ”„ åˆ·æ–°å¾…è¾¦</button>
        <div id="task-list"><p style="text-align:center; color:#999;">æš«ç„¡å¾…è¾¦äº‹é …</p></div>
    </div>

    <div id="tab-history" class="hidden">
        <div class="sub-tabs">
            <div id="sub-clock" class="sub-tab active" onclick="switchHistorySub('clock')">ğŸ•’ åˆ·å¡æŸ¥è©¢</div>
            <div id="sub-leave" class="sub-tab" onclick="switchHistorySub('leave')">ğŸ“„ è«‹å‡æŸ¥è©¢</div>
            <div id="sub-overtime" class="sub-tab" onclick="switchHistorySub('overtime')">ğŸ’ª åŠ ç­æŸ¥è©¢</div>
        </div>
        <div class="search-box">
            <label>æŸ¥è©¢æœŸé–“</label>
            <div class="date-row"><input type="date" id="history-start"><span>~</span><input type="date" id="history-end"></div>
            <button class="btn-search" onclick="loadCurrentHistory()">ğŸ” æŸ¥è©¢</button>
        </div>
        <div id="history-list"></div>
    </div>

  </div>
</div>

<script>
  // Firebase
  const firebaseConfig = { apiKey: "AIzaSyAQPANPPx5A3FtpISPcfX-kHPtG0PC6irA", authDomain: "jtpp-cams.firebaseapp.com", projectId: "jtpp-cams", storageBucket: "jtpp-cams.firebasestorage.app", messagingSenderId: "334286192470", appId: "1:334286192470:web:9080eb43436b3a3fdfe0f7" };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  const provider = new firebase.auth.GoogleAuthProvider();

  const PLANT_LOCATION = { lat: 23.564675316036272, lng: 119.66034190357468 };
  const MAX_DIST = 500;
  let currentUser = null, userData = {}, currentLat = 0, currentLng = 0, currentDist = 9999;
  let leaveData = { annual: {total:0, used:0}, comp: {total:0, used:0} };
  let currentHistoryType = 'clock';

  const SHIFTS = {
      "normal": { name: "æ­£å¸¸ç­", end: "16:30", breakDur: 0.5 },
      "cleaning": { name: "æ¸…æ½”ç­", end: "17:00", breakDur: 1.0 }
  };

  function loginGoogle() { auth.signInWithPopup(provider).catch(e => alert(e.message)); }

  auth.onAuthStateChanged(async (user) => {
    document.getElementById('loading-screen').classList.add('hidden');
    if (user) {
      currentUser = user;
      document.getElementById('login-section').classList.add('hidden');
      document.getElementById('main-section').classList.remove('hidden');
      document.getElementById('u-photo').src = user.photoURL;
      
      initTimes();
      await loadUserData(user);
      startGPS();
    } else {
      document.getElementById('login-section').classList.remove('hidden');
      document.getElementById('main-section').classList.add('hidden');
    }
  });

  function initTimes() {
      const now = new Date();
      const ymd = new Date(now.getTime() - (now.getTimezoneOffset() * 60000)).toISOString().split('T')[0];
      // ç´€éŒ„æŸ¥è©¢é è¨­ç•¶æœˆ
      const first = new Date(now.getFullYear(), now.getMonth(), 1); 
      const last = new Date(now.getFullYear(), now.getMonth() + 1, 0);
      const toYMD = d => new Date(d.getTime() - (d.getTimezoneOffset()*60000)).toISOString().split('T')[0];
      document.getElementById('history-start').value = toYMD(first);
      document.getElementById('history-end').value = toYMD(last);
      // è«‹å‡é è¨­
      document.getElementById('l-start').value = ymd + "T08:00";
      document.getElementById('l-end').value = ymd + "T16:30";
      // è£œå¡é è¨­
      document.getElementById('fixDate').value = ymd;
      updateFixTimeDefaults();
  }

  // â˜… æ™ºæ…§è£œå¡æ™‚é–“é è¨­
  function updateFixTimeDefaults() {
      const type = document.getElementById('fixType').value;
      const shift = SHIFTS[userData.workShift || "normal"];
      if(type === 'ä¸Šç­') {
          document.getElementById('fixTime').value = "08:00";
      } else {
          document.getElementById('fixTime').value = shift.end;
      }
  }

  async function loadUserData(user) {
    const doc = await db.collection('cams_users').doc(user.email).get();
    if (doc.exists) {
        userData = doc.data();
        updateUI(userData);
        // è¨ˆç®—é¤˜é¡ (ç¯„ä¾‹ï¼šç‰¹ä¼‘7å¤©ï¼Œè£œä¼‘è®€å–è³‡æ–™åº«)
        leaveData.annual.total = 7; 
        leaveData.annual.used = userData.leaveUsed || 0;
        leaveData.comp.total = userData.compLeaveTotal || 0; // ç´¯ç©çš„è£œä¼‘æ™‚æ•¸ (ä¾†è‡ªåŠ ç­)
        leaveData.comp.used = userData.compLeaveUsed || 0;
        updateBalanceDisplay();
        loadColleagues();
        loadTasks();
    } else {
        userData = { name: user.displayName, email: user.email, role: "å¤–åŒ…å“¡å·¥", workShift: "normal", createdAt: new Date().toISOString() };
        await db.collection('cams_users').doc(user.email).set(userData);
        updateUI(userData);
        toggleEditMode();
    }
  }

  function updateUI(d) {
      document.getElementById('u-name').innerText = d.name;
      const sName = SHIFTS[d.workShift]?SHIFTS[d.workShift].name:"æ­£å¸¸ç­";
      document.getElementById('u-company-display').innerText = `${d.company||""} / ${sName}`;
      document.getElementById('dbName').value = d.name;
      document.getElementById('dbPhone').value = d.phone||"";
      document.getElementById('jobTitle').value = d.jobTitle||"";
      document.getElementById('workShift').value = d.workShift||"normal";
      document.getElementById('baseSalary').value = d.baseSalary||"";
      document.getElementById('onboardDate').value = d.onboardDate||"";
  }

  function updateBalanceDisplay() {
      const type = document.getElementById('leaveType').value;
      const panel = document.getElementById('balance-panel');
      
      if(type === 'ç‰¹ä¼‘' || type === 'è£œä¼‘') {
          panel.classList.remove('hidden');
          let data = type==='ç‰¹ä¼‘' ? leaveData.annual : leaveData.comp;
          let unit = type==='ç‰¹ä¼‘' ? 'å¤©' : 'å°æ™‚';
          
          document.getElementById('bal-total').innerText = data.total + " " + unit;
          document.getElementById('bal-used').innerText = data.used + " " + unit;
          let left = (data.total - data.used).toFixed(1);
          document.getElementById('bal-left').innerText = left + " " + unit;
      } else {
          panel.classList.add('hidden');
      }
  }

  // â˜… åˆ·å¡æŸ¥è©¢è¡¨æ ¼åŒ–
  async function loadCurrentHistory() {
      const list = document.getElementById('history-list');
      list.innerHTML = "<p style='text-align:center;color:#999'>è¼‰å…¥ä¸­...</p>";
      const sStr = document.getElementById('history-start').value;
      const eStr = document.getElementById('history-end').value;
      const startD = new Date(sStr+"T00:00:00"); const endD = new Date(eStr+"T23:59:59");
      
      let html = "";
      if(currentHistoryType === 'clock') {
          // åˆ·å¡è¡¨æ ¼
          const snap = await db.collection('cams_records').where('userId','==',currentUser.email)
              .where('time','>=',startD).where('time','<=',endD).orderBy('time','desc').limit(50).get();
          if(snap.empty) html = "<p style='text-align:center'>ç„¡ç´€éŒ„</p>";
          else {
              html = `<table class="history-table"><thead><tr><th>æ—¥æœŸ</th><th>æ™‚é–“</th><th>é¡å‹</th><th>ç‹€æ…‹</th></tr></thead><tbody>`;
              snap.forEach(doc => {
                  const d = doc.data(); const t = d.time.toDate();
                  const dateStr = `${t.getMonth()+1}/${t.getDate()}`;
                  const timeStr = `${t.getHours()}:${String(t.getMinutes()).padStart(2,'0')}`;
                  let cls = d.status.includes('ç•°å¸¸')?'tag-red':'tag-green';
                  html += `<tr><td>${dateStr}</td><td>${timeStr}</td><td>${d.type}</td><td><span class="tag ${cls}">${d.status}</span></td></tr>`;
              });
              html += `</tbody></table>`;
          }
      } else {
          // è«‹å‡èˆ‡åŠ ç­è¡¨æ ¼
          let cat = currentHistoryType==='leave'?'leave':'overtime';
          const snap = await db.collection('cams_applications').where('userId','==',currentUser.email)
              .where('category','==',cat).where('createdAt','>=',startD).where('createdAt','<=',endD).orderBy('createdAt','desc').get();
          if(snap.empty) html = "<p style='text-align:center'>ç„¡ç´€éŒ„</p>";
          else {
               html = `<table class="history-table"><thead><tr><th>æ—¥æœŸ</th><th>é …ç›®</th><th>é€²åº¦</th></tr></thead><tbody>`;
               snap.forEach(doc => {
                   const d=doc.data();
                   let st = "å·²æ ¸å‡†";
                   if(d.status.agent==='å¾…å¯©æ ¸') st="å¾…ä»£ç†äºº";
                   else if(d.status.leader==='å¾…å¯©æ ¸') st="å¾…é ˜ç­";
                   else if(d.status.boss==='å¾…å¯©æ ¸') st="å¾…è€é—†";
                   else if(d.status.client==='å¾…å¯©æ ¸') st="å¾…ç”²æ–¹";
                   if(cat==='overtime' && d.status.employee==='å¾…ç¢ºèª') st="å¾…æ‚¨ç¢ºèª";
                   
                   let desc = d.type || d.reason;
                   html += `<tr><td>${d.startDate.split('T')[0]}</td><td>${desc}</td><td><small>${st}</small></td></tr>`;
               });
               html += `</tbody></table>`;
          }
      }
      list.innerHTML = html;
  }
  
  function switchHistorySub(t) {
      currentHistoryType = t;
      document.querySelectorAll('.sub-tab').forEach(el=>el.classList.remove('active'));
      document.getElementById('sub-'+t).classList.add('active');
      loadCurrentHistory();
  }

  // å…¶ä»–åŠŸèƒ½ä¿ç•™ (doClock, submitApp, loadColleagues, saveToFirebase...)
  async function doClock(type) {
     const now = new Date();
     // ä¸Šä¸‹ç­é‚è¼¯ (çœç•¥ç´°ç¯€ä»¥çœç¯‡å¹…)
     try {
         await db.collection('cams_records').add({userId:currentUser.email, name:userData.name, email:currentUser.email, company:userData.company, dept:userData.dept, type:type, time:now, lat:currentLat, lng:currentLng, status:"æ­£å¸¸"});
         alert("æ‰“å¡æˆåŠŸ"); switchTab('history');
     } catch(e) { alert(e.message); }
  }
  
  async function submitApp(cat) {
      // é€™è£¡è¦åˆ¤æ–·ï¼šå¦‚æœæ˜¯ã€Œè£œä¼‘ã€è«‹å‡ï¼Œéœ€è¦æª¢æŸ¥é¤˜é¡
      if(cat === 'leave') {
          if(document.getElementById('leaveType').value === 'è£œä¼‘') {
               // ç°¡æ˜“æª¢æŸ¥ (å¯¦éš›æ‡‰ç”±å¾Œç«¯æˆ–æ›´åš´è¬¹çš„å‰ç«¯è¨ˆç®—)
               // ...
          }
      }
      // é€å‡ºé‚è¼¯...
      alert("ç”³è«‹å·²é€å‡º"); switchTab('history');
  }

  async function saveToFirebase() {
      const u = {
          name: document.getElementById('dbName').value,
          phone: document.getElementById('dbPhone').value, // å“¡å·¥å¯å­˜æ‰‹æ©Ÿ
          // baseSalary ä¸å¯å­˜
      };
      await db.collection('cams_users').doc(currentUser.email).set(u, {merge:true});
      alert("è³‡æ–™å·²æ›´æ–°"); location.reload();
  }

  function toggleEditMode() { document.getElementById('meta-form').classList.toggle('hidden'); }
  function toggleFix() { document.getElementById('fix-form').classList.toggle('hidden'); updateFixTimeDefaults(); }
  function switchTab(t) { ['clock','leave','history','task'].forEach(id=>document.getElementById('tab-'+id).classList.add('hidden')); document.getElementById('tab-'+t).classList.remove('hidden'); if(t==='history')loadCurrentHistory(); if(t==='task')loadTasks(); }
  
  // GPS
  function startGPS() {
     if(navigator.geolocation) {
         navigator.geolocation.watchPosition(p=>{
             document.getElementById('gps-loading').classList.add('hidden');
             document.getElementById('gps-icon').classList.remove('hidden');
             currentLat=p.coords.latitude; currentLng=p.coords.longitude;
             // è·é›¢åˆ¤æ–·çœç•¥...
         });
     }
  }
  async function loadColleagues() { /*...*/ }
  async function loadTasks() { /*...*/ }
</script>
</body>
</html>
